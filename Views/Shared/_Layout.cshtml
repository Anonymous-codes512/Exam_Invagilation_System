<!DOCTYPE html>
<html lang="en">
<head>
	<script>
		(function () {
			try {
				if (localStorage.getItem("darkMode") === "enabled") {
					document.documentElement.classList.add("dark");
				}
			} catch (e) {}
		})();
	</script>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
	<title>@ViewData["Title"] - Exam_Invigilation_System</title>
	<link rel="stylesheet" href="@ViewData["StyleSheet"]" asp-append-version="true" />
	<link rel="icon" type="image/x-icon" href="~/favicon.ico" asp-append-version="true" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" rel="stylesheet" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body id="body-pd">
	<header>
		<nav class="navbar">
			<div class="logo_item mb-2">
				<i class="bx bx-menu" id="sidebarOpen"></i>
				<img src="~/images/CUI WAH EIS.png" alt="">Exam_Invigilation_System
			</div>

			@* <div class="search_bar">
				<input type="text" placeholder="Search" />
			</div> *@

			<div class="d-flex align-items-center gap-3 text-color justify-content-end">
				<i class='bx bx-sun' id="darkLight"></i>

				<div class="navbar_content d-flex align-items-center gap-2">
					<img src="~/images/profile.jpg" alt="" class="profile" />
					@using System.Security.Claims
					@{
						var email = User.FindFirstValue(ClaimTypes.Email);
						var name = User.FindFirstValue(ClaimTypes.Name);
					}
					<div class="d-flex flex-column">
						<p class="mb-0 fw-bold">@name</p>
						<p class="mb-0 text-muted">@email</p>
					</div>
				</div>
			</div>


			<div class="dropdown_wrapper hide dropdown_wrapper--fade-in none">
				<nav>
					 @* <ul>
						<li data-bs-toggle="modal" data-bs-target="#profileModal">
							<i class="bx bxs-user-circle"></i> My profile
						</li>
					 </ul>
					 <hr class="divider"> *@
					<ul>
						<li>
							<a class="text-decoration-none"  asp-controller="Auth" asp-action="Logout">
								<i class="bx bx-log-out-circle"></i>
								Sign Out
							</a>
						</li>

					</ul>
				</nav>
			</div>
		</nav>
	</header>
	<div class="containers">
		<aside>
			<nav class="sidebar">
				<div class="menu_content">
					<ul class="menu_items">
						<li class="item">
							<a class="nav_link" asp-controller="Home" asp-action="Dashboard">
								<span class="navlink_icon"><i class="bx bx-grid-alt nav_icon"></i></span>
								<span class="navlink">Dashboard</span>
							</a>
						</li>
						<li class="item">
							<a href="#" class="nav_link submenu_item">
								<span class="navlink_icon">
									<i class="bi bi-database-add"></i></span>
								<span class="navlink">Insert Data</span>
								<i class="bx bx-chevron-right arrow-left"></i>
							</a>
							<ul class="menu_items submenu">
								<li><a asp-controller="InsertStudent" asp-action="Student" class="nav_link sublink">Students</a></li>
								<li><a asp-controller="InsertTeacher" asp-action="Teacher" class="nav_link sublink">Teachers</a></li>
								<li><a asp-controller="InsertRoom" asp-action="Room" class="nav_link sublink">Rooms</a></li>
								<li><a asp-controller="InsertCourse" asp-action="Course" class="nav_link sublink">Courses</a></li>
								<li><a asp-controller="DateSheet" asp-action="DateSheet" class="nav_link sublink">Date Sheet</a></li>
							</ul>
						</li>
					</ul>
					<ul class="menu_items">
						<li class="item">
							<a asp-controller="CourseRegister" asp-action="StudentCourses" class="nav_link">
								<span class="navlink_icon">
									<i class="bi bi-person-badge"></i>
								</span><span class="navlink">
									Register Courses
								</span>
							</a>
						</li>
						<li class="item">
							<a class="nav_link" asp-controller="TeacherDuty" asp-action="Index">
								<span class="navlink_icon">
									<i class="bx bx-calendar nav_icon"></i>
								</span><span class="navlink">Teacher Duty</span>
							</a>
						</li>
						<li class="item">
							<a class="nav_link" asp-controller="SeatingPlan" asp-action="Index">
								<span class="navlink_icon">
									<i class="bx bx-chair nav_icon"></i>
								</span><span class="navlink">Seating Plan</span>
							</a>
						</li>
						<li class="item">
							<a asp-controller="Attendance" asp-action="Index" class="nav_link">
								<span class="navlink_icon">
									<i class='bx bx-check nav_icon'></i>
								</span>
								<span class="navlink">Attendance</span>
							</a>
						</li>
					</ul>
					<ul class="menu_items">
						<li class="item">
							<a asp-controller="PaperSummary" asp-action="Index" class="nav_link">
								<span class="navlink_icon">
									<i class='bx bx-book nav_icon'></i>
								</span><span class="navlink">Paper Summary</span>
							</a>
						</li>
						<li class="item">
							<a asp-controller="UnfairMeansReporting" asp-action="Index" class="nav_link">
								<span class="navlink_icon">
									<i class='bx bx-x nav_icon'></i>
								</span><span class="navlink">Unfair Reporting</span>
							</a>
						</li>
					</ul>
					<div class="bottom_content">
						<div class="bottom expand_sidebar"><span> Expand</span><i class='bx bx-log-in'></i></div>
						<div class="bottom collapse_sidebar"><span> Collapse</span><i class='bx bx-log-out'></i></div>
					</div>
				</div>
			</nav>
		</aside>
		<!-- Profile Modal -->
		<div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content p-3">
					<div class="modal-header">
						<h5 class="modal-title">My Profile</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>

					<div class="modal-body">
						<!-- Profile Card -->
						<div class="card mb-4">
							<div class="card-body d-flex gap-4 align-items-center">
								<img src="~/images/profile.jpg" alt="Profile Picture" class="rounded-circle border" width="120" height="120" />
								<div>
									<h5 class="mb-1">@name</h5>
									<p class="mb-0 text-muted">@email</p>
									<p class="mb-0 text-muted">Other Info Here</p>
								</div>
							</div>
						</div>

						<!-- Password Change Card -->
						<div class="card">
							<div class="card-header">
								<h6 class="mb-0">Change Password</h6>
							</div>
							<div class="card-body">
								<form id="passwordForm">
									<div class="mb-3 password-wrapper">
										<label class="form-label">Current Password</label>
										<input type="password" class="form-control password-field" required>
										@* <i class="toggle-password bi bi-eye position-absolute top-50 end-0 translate-middle-y me-3 cursor-pointer"></i> *@
									</div>
									<div class="mb-3 password-wrapper">
										<label class="form-label">New Password</label>
										<input type="password" class="form-control password-field" id="newPassword" required>
										@* <i class="toggle-password bi bi-eye position-absolute top-50 end-0 translate-middle-y me-3 cursor-pointer"></i> *@
									</div>
									<div class="mb-3 password-wrapper">
										<label class="form-label">Confirm New Password</label>
										<input type="password" class="form-control password-field" id="confirmPassword" required>
										@* <i class="toggle-password bi bi-eye position-absolute top-50 end-0 translate-middle-y me-3 cursor-pointer"></i> *@
									</div>
									<div class="text-end">
										<button type="submit" class="btn btn-primary">Change Password</button>
									</div>
								</form>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>

		<script>
			// Password toggle
			document.querySelectorAll(".toggle-password").forEach(icon => {
				icon.addEventListener("click", function () {
					const input = this.previousElementSibling;
					if (input.type === "password") {
						input.type = "text";
						this.classList.replace("bi-eye", "bi-eye-slash");
					} else {
						input.type = "password";
						this.classList.replace("bi-eye-slash", "bi-eye");
					}
				});
			});

			// Password validation
			document.getElementById("passwordForm").addEventListener("submit", function (e) {
				const newPass = document.getElementById("newPassword").value;
				const confirmPass = document.getElementById("confirmPassword").value;

				const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,16}$/;

				if (newPass !== confirmPass) {
					e.preventDefault();
					alert("Passwords do not match!");
				} else if (!regex.test(newPass)) {
					e.preventDefault();
					alert("Password must be 8-16 characters and include uppercase, lowercase, number, and special character.");
				}
			});
		</script>


		<main>

			@if (TempData["success"] != null || TempData["error"] != null)
			{
				<div class="notification-container">
					<div class="notification @(TempData["success"] != null ? "notification--success" : "notification--error")">
						<div class="notification_body">
							<i class='bx @(TempData["success"] != null ? "bx-check-circle" : "bx-x-circle")'></i>
							@TempData["success"]
							@TempData["error"]
						</div>
						<div class="notification_progress"></div>
					</div>
				</div>
			}
			@* <partial name="_Notification" /> *@
			@RenderBody()
		</main>
	</div>

	<script src="~/lib/jquery/dist/jquery.min.js"></script>
	<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	<script src="~/js/script.js" asp-append-version="true"></script>
	@await RenderSectionAsync("Scripts", required: false)
</body>
</html>
